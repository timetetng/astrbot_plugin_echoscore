# AstrBot 声骸评分插件 (astrbot\_plugin\_echoscore)

[](https://github.com/timetetng/astrbot_plugin_echoscore)

一个为 [AstrBot](https://github.com/AstrBotDevs/AstrBot) 设计的《鸣潮》声骸评分插件。它基于 Loping151 的声骸识别评分API，让您可以通过发送截图，以指令或与大语言模型（LLM）对话的方式，快速为您的声骸进行评分。


## ✨ 致谢

本插件是基于 [**Loping151/ScoreEcho**](https://github.com/Loping151/ScoreEcho) 项目的 API 进行的二次开发，并适配了 AstrBot 框架。所有核心的图像识别与评分能力均由原作者提供。

在此向 [Loping151](https://github.com/Loping151) 的出色工作与无私分享表示诚挚的感谢！

## 🚀 功能特性

  - **截图评分**：发送游戏内声骸面板的截图即可获得评分结果图。
  - **双模式交互**：
    1.  **指令模式**：使用 `/评分` 等指令，精确控制评分角色、COST等参数。
    2.  **LLM 模式**：在与AI对话时，直接让它帮你为图片中的声骸评分，体验更自然。
  - **智能图片获取**：不仅支持处理单张、多张图片，也支持对聊天中回复（引用）的图片进行评分。
  - **上下文缓存**：插件会自动缓存对话中最近发送的图片。您可以先发图片，再用指令或@AI进行评分，无需将图片和指令绑定在同一条消息中。
  - **角色别名支持**：支持自定义角色别名。默认使用小维API的别名解析，若在配置项中开启并配置别名文件路径，插件会自动使用你的别名表映射到标准角色名。
  - **高度可配置**：所有核心功能如上下文缓存、别名映射等均可在 AstrBot WebUI 中轻松开启或关闭。

## 🔧 安装与配置

1.  **安装插件**：

      - 请从本仓库下载插件，并将其完整放置于 AstrBot 的 `data/plugins` 目录下。
      - 重启 AstrBot 以加载插件。

2.  **获取 Token**：

      - 此插件需要 `xwtoken` 才能访问评分API。请联系原作者 **小维([Loping151](https://github.com/Loping151))** 申请你的 Token。

3.  **配置插件**：

      - 插件首次加载后，请进入 AstrBot 的 **WebUI \> 插件市场 \> astrbot\_plugin\_echoscore**。
      - 点击“管理”，在配置项中根据您的需求进行设置：

| 配置项                 | 类型    | 描述                                                                                                       | 默认值                                                                                 |
| ---------------------- | ------- | ---------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------- |
| `xwtoken`              | string  | (必填) 请向小维申请你的API Token。                                                                   | `your_token_here`                                                                      |
| `endpoint`             | string  | 评分API的完整URL。通常无需修改。                                                                           | `https://scoreecho.Loping151.site/score`                                                 |
| `enable_context_cache` | bool    | **（推荐开启）** 是否开启上下文图片缓存。开启后，可先发图再发指令。                                         | `true`                                                                                 |
| `context_cache_size`   | int     | 在一个对话中，最多缓存多少张最近的图片。这些图片都会自动传给评分API，请不要配置太多                                                                   | `2`                                                                                    |
| `enable_alias_mapping` | bool    | 是否启用自定义角色别名。开启后，可使用你自己WWUID的角色别名配置进行映射。                                        | `false`                                                                                |
| `alias_file_path`      | string  | 角色别名JSON文件的绝对路径。推荐与 [WutheringWavesUID](https://github.com/tyql688/WutheringWavesUID) 插件共用同一份别名文件。 | `gsuid_core/plugins/WutheringWavesUID/WutheringWavesUID/utils/alias/char_alias.json` |

## 📝 使用说明

配置完成后，您可以通过以下两种方式使用本插件：

## 如果无法评分请检查是否配置 **xwtoken** 以及 **LLM模型提供商**！！！

### 方式一：指令调用

您可以通过发送指令或别名来触发评分。

  - **基础指令**: `评分`
  - **指令别名**: `声骸`, `生蚝`
  - **辅助指令**: `清空评分缓存`，用于清除当前对话的图片缓存，避免评分时识别到错误的图片。

**使用格式：**

```
/评分 [角色名] [Cost] [主词条]
```

部分角色套装支持自动识别，参数均为可选。

### 参数间无需空格 能自动解析！

**示例：**

1.  **自动识别 (指令指定图片事件**

      - 发送图片或引用图片，并附上消息 `/评分卡提1c`。

2.  **自动识别 (利用上下文缓存)**

      - **第一步**: 发送一张或多张声骸截图（缓存图片数量在配置项配置）。
      - **第二步**: 在下一条消息中发送 `/声骸卡提4c`。

3.  **指定参数** (当图片识别不清或想指定主词条时)

      - 发送图片，并附上消息 `/查分香料`
      - 发送图片，并附上消息 `/生蚝 吟霖 4c 导电伤害`

### 方式二：LLM (大语言模型) 调用

当您使用具有工具调用（Tool Calling）能力的LLM模型，并在人格设置中启用`score_wuthering_waves_echo`工具时，可以直接通过自然语言让它为您评分。

上下文缓存和角色别名同样在 LLM 模式下生效。

**示例：**

1.  **直接请求**

    > **你**：（发送一张声骸截图）
    > **你**：帮我看一下这个声骸

2.  **结合角色请求**

    > **你**：（发送一张声骸截图）
    > **你**：看看这个1c给**大贝姐**用怎么样？

3.  **在回复中请求**

    > **你**：（回复一张别人发的声骸截图）
    > **你**：这张图的吟霖4c怎么样？

LLM 会自动理解您的意图，找到上下文中的图片，调用评分工具并返回结果。
